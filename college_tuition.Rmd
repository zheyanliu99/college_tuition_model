---
title: "Assignment 2"
author: "Zheyan Liu"
output:
  pdf_document:
    toc: yes
    toc_depth: 2
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '2'
--- 


```{r, include=FALSE}
library(RNHANES)
library(tidyverse)
library(summarytools)
library(leaps)
library(ISLR)
library(glmnet)
library(caret)
library(corrplot)
library(plotmo)
library(pls)
library(ggplot2)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "95%"
)

theme_set(theme_minimal() + theme(legend.position = 'bottom'))

options(
  ggplot2.continuous.colour = 'viridis',
  ggplot2.continuous.fill = 'viridis'
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

\newpage

## Intro and data preparation

we build nonlinear models using the “College” data. The dataset
contains statistics for 565 US Colleges from a previous issue of US News and World Report.
The response variable is the out-of-state tuition (Outstate).

### Read data

Drop college column

```{r}
df = 
  read_csv('data/College.csv', show_col_types = FALSE) %>% 
  janitor::clean_names() %>% 
  select(-college)
```

### Split the dataset into training and testing

Partition the dataset into two parts: training data (80%) and test data (20%).

```{r}
trainRows <- createDataPartition(y = df$outstate, p = 0.8, list = FALSE)
training_df = df[trainRows, ]
testing_df = df[-trainRows, ]

x_train <- model.matrix(outstate~.,training_df)[,-1]
y_train <- training_df$outstate

x_test <- model.matrix(outstate~.,testing_df)[,-1]
y_test <- testing_df$outstate
```


## (a) Perform exploratory data analysis using the training data

There are `r ncol(training_df)` variables in the data and `r nrow(training_df)` observations.

### summary statistics

All variables are continuous

```{r}
summary(training_df)
```
### histogram of response variable

Distribution of outstate is close to normal distribution, much outstate is around 10000 except a second peak around 17500

```{r}
ggplot(training_df, aes(x=outstate)) + 
  geom_histogram(bins = 32)
```

### correlation of response vs. predictors

Correlation plot shows that some variables are highly correlated with outstate and there is multicollinearity.

```{r}
corrplot::corrplot(cor(training_df %>% select(where(is.numeric)) %>% relocate(outstate)), method = "circle", type = "full")
```
Plot scatterplot of response variables with selection of highly correlated predictors including top10perc, room_board, ph_d, terminal, s_f_ratio and expend. Only s_f_ratio is negatively correlated.

```{r}
library(patchwork)
p1 = ggplot(training_df, aes(x=top10perc, y=outstate)) + geom_point(alpha=0.3)
p2 = ggplot(training_df, aes(x=room_board, y=outstate)) + geom_point(alpha=0.3)
p3 = ggplot(training_df, aes(x=ph_d, y=outstate)) + geom_point(alpha=0.3)
p4 = ggplot(training_df, aes(x=terminal, y=outstate)) + geom_point(alpha=0.3)
p5 = ggplot(training_df, aes(x=s_f_ratio, y=outstate)) + geom_point(alpha=0.3)
p6 = ggplot(training_df, aes(x=expend, y=outstate)) + geom_point(alpha=0.3)

(p1 + p2 + p3)/(p4 + p5 + p6)
```


## (b) Fit smoothing spline models using Terminal as the only predictor of Outstate



## (c) Fit a generalized additive model (GAM) using all the predictors. 



## (d) Train a multivariate adaptive regression spline (MARS) model using all the predictors



# (e) Model selection